(function(t){function e(e){for(var o,s,a=e[0],l=e[1],c=e[2],d=0,p=[];d<a.length;d++)s=a[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&p.push(n[s][0]),n[s]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);u&&u(e);while(p.length)p.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],o=!0,a=1;a<i.length;a++){var l=i[a];0!==n[l]&&(o=!1)}o&&(r.splice(e--,1),t=s(s.s=i[0]))}return t}var o={},n={edit:0},r=[];function s(e){if(o[e])return o[e].exports;var i=o[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=o,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(i,o,function(e){return t[e]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=e,a=a.slice();for(var c=0;c<a.length;c++)e(a[c]);var u=l;r.push([3,"chunk-vendors","chunk-common"]),i()})({"11f2":function(t,e,i){"use strict";i.r(e);var o=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"v"}},[i("v-header",{attrs:{location:"/edit"},on:{logged:t.logged}}),i("message-box"),i("main",[i("h2",[t._v(t._s(t.title))]),t.photo?i("v-form",{attrs:{photo:t.photo}}):t._e()],1),i("v-footer")],1)},r=[],s=i("1157"),a=i.n(s),l=i("71c2"),c=i("f771"),u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("form",{attrs:{method:"post"},on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[i("div",[i("file-input",{attrs:{accept:"image/*",file:t.file},on:{"update:file":function(e){t.file=e}}}),i("input",{staticClass:"action",attrs:{type:"button",value:"Choose a photo"},on:{click:t.chooseFile}}),i("span",[t._v(t._s(t.alt))])],1),void 0!==t.file?i("div",[i("img",{attrs:{src:t.src,alt:t.alt}}),i("hr"),i("div",{staticClass:"info"},[i("label",[i("span",[t._v("Title")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",required:""},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),i("label",[i("span",[t._v("Description")]),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],attrs:{required:""},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})]),i("contents-input",{attrs:{contents:t.contents},on:{"update:contents":function(e){t.contents=e}}}),i("visibility-select",{attrs:{visibility:t.visibility},on:{"update:visibility":function(e){t.visibility=e}}}),i("location-select",{attrs:{country:t.country,city:t.city,"city-name":t.cityName},on:{"update:country":function(e){t.country=e},"update:city":function(e){t.city=e}}}),i("confirm-box",{attrs:{show:t.showConfirm,result:t.confirmResult,"default-result":""},on:{"update:show":function(e){t.showConfirm=e},"update:result":function(e){t.confirmResult=e}}},[t._v("Commit changes?")]),t.showConfirm?t._e():i("input",{staticClass:"action",attrs:{type:"submit",value:"Edit"}})],1)]):t._e()])},d=[],p=i("2ef0"),h=i.n(p),f=i("f37b"),m=i("ad46"),v=i("e385"),y=i("9c6f"),b=i("89f5");let g=h.a.once(()=>a()("#message-box")[0].__vue__);var w={name:"v-form",components:{FileInput:f["a"],ContentsInput:m["a"],VisibilitySelect:v["a"],LocationSelect:y["a"],ConfirmBox:b["a"]},props:{photo:Object},data:function(){return{file:null,src:syt.backend+"/img/"+this.photo.path,alt:this.photo.path,title:this.photo.title,description:this.photo.description,contents:[this.photo.content1,this.photo.content2,this.photo.content3,this.photo.content4],visibility:this.photo.visibilityID,country:this.photo.countryCode,city:this.photo.cityID,cityName:this.photo.cityName,showConfirm:!1,confirmResult:void 0}},methods:{submit(){this.showConfirm=!0},chooseFile(t){a()(t.target).prev().click()}},watch:{file(){if(void 0===this.file)this.alt=void 0;else{let t=new FileReader;t.readAsDataURL(this.file),t.onload=()=>{this.src=t.result,this.alt=this.file.name}}},confirmResult(){let t=()=>{this.confirmResult=!1,g().message="Unauthorized operation. You may try uploading again or refreshing the page",location.replace("#")};if(!0===this.confirmResult){let e={image:this.photo.imageID,title:this.title,description:this.description,contents:this.contents,visibility:this.visibility,city:this.city};null!==this.file&&(e.file=this.file.name),a.a.ajax({method:"POST",url:syt.backend+"/edit",xhrFields:{withCredentials:!0},data:e,dataType:"text",success:e=>{switch(e){case"ok":if(null===this.file)window.location="/photos";else{let e=new FileReader;e.readAsArrayBuffer(this.file),e.onload=()=>{a.a.ajax({method:"POST",url:syt.backend+"/edit",xhrFields:{withCredentials:!0},contentType:!1,processData:!1,data:e.result,dataType:"text",success:e=>{switch(e){case"ok":window.location="/photos";break;case"unauthorized":t();break}}})}}break;case"unauthorized":t();break}}})}}}},x=w,_=(i("898a"),i("2877")),j=Object(_["a"])(x,u,d,!1,null,"6fd4b540",null),k=j.exports,C=i("076e"),O={name:"v",components:{VHeader:l["a"],MessageBox:c["a"],VForm:k,VFooter:C["a"]},data:function(){return{title:"Edit",photo:void 0}},mounted:function(){let t=location.toString().match(/.*\?image=(\d+)#?$/);null!==t?a.a.ajax({method:"GET",url:syt.backend+"/edit",xhrFields:{withCredentials:!0},data:{image:t[1]},dataType:"json",success:t=>{404===t?this.error():this.photo=t}}):this.error()},methods:{logged(){syt.logged||(window.location="/login")},error(){this.title="404 Not Found",document.title=this.title}}},F=O,P=Object(_["a"])(F,n,r,!1,null,"293043f4",null),T=P.exports;o["a"].config.productionTip=!1,new o["a"]({render:t=>t(T)}).$mount("#v")},"2d06":function(t,e,i){},3:function(t,e,i){t.exports=i("11f2")},"898a":function(t,e,i){"use strict";var o=i("2d06"),n=i.n(o);n.a}});
//# sourceMappingURL=edit.40ba5375.js.map